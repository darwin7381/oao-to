# API å¹³å°èˆ‡ Admin Portal å®Œæ•´ç‹€æ…‹

**æ›´æ–°æ—¥æœŸ**: 2026-01-24  
**ç‰ˆæœ¬**: V1.1 (Admin Portal å®Œæˆ)  
**ç‹€æ…‹**: âœ… æ ¸å¿ƒåŠŸèƒ½ + Admin Portal å·²å®Œæˆ

---

## ğŸ‰ æœ€æ–°å®Œæˆï¼šAdmin Portal (2026-01-24)

### **Admin Portal æ¶æ§‹**

#### **å‰ç«¯** (8 å€‹é é¢)
- âœ… `/admin/analytics` - åˆ†æç¸½è¦½ï¼ˆåœ–è¡¨åŒ–ï¼‰
- âœ… `/admin/links` - é€£çµç®¡ç†ï¼ˆ22 å€‹çœŸå¯¦é€£çµï¼‰
- âœ… `/admin/api-keys` - API Keys ç›£æ§ï¼ˆ4 å€‹çœŸå¯¦ keysï¼‰
- âœ… `/admin/users` - ç”¨æˆ¶ç®¡ç†ï¼ˆ3 å€‹ç”¨æˆ¶ï¼‰
- âœ… `/admin/payments` - ä»˜æ¬¾ç®¡ç†
- âœ… `/admin/credits` - Credits ç®¡ç†ï¼ˆæ‰‹å‹•èª¿æ•´ï¼‰
- âœ… `/admin/stats` - ç³»çµ±çµ±è¨ˆ
- âœ… `/admin/settings` - ç³»çµ±è¨­å®š

#### **å¾Œç«¯ API** (7 å€‹ endpoints)
- âœ… `GET /api/admin/stats` - ç³»çµ±çµ±è¨ˆ
- âœ… `GET /api/admin/users` - æ‰€æœ‰ç”¨æˆ¶
- âœ… `GET /api/admin/links` - æ‰€æœ‰é€£çµï¼ˆå¾ KV + AEï¼‰
- âœ… `GET /api/admin/api-keys` - æ‰€æœ‰ API Keys
- âœ… `GET /api/admin/analytics` - å…¨ç«™åˆ†æ
- âœ… `GET /api/admin/payments` - ä»˜æ¬¾è¨˜éŒ„
- âœ… `GET /api/admin/credits/users` - æ‰€æœ‰ç”¨æˆ¶ Credits
- âœ… `POST /api/admin/credits/adjust` - æ‰‹å‹•èª¿æ•´ Credits
- âœ… `DELETE /api/admin/links/:slug` - åˆªé™¤é€£çµ
- âœ… `POST /api/admin/links/:slug/flag` - æ¨™è¨˜/ç¦ç”¨é€£çµ
- âœ… `POST /api/admin/api-keys/:keyId/revoke` - æ’¤éŠ· API Key

#### **æ•¸æ“šåº«** (æ–°å¢)
- âœ… `payments` è¡¨ - ä»˜æ¬¾è¨˜éŒ„
- âœ… `credit_transactions.admin_id` - Admin æ“ä½œè¿½è¹¤

#### **æ¶æ§‹æ–‡æª”** (æ–°å¢)
- âœ… `ADMIN_PORTAL_ARCHITECTURE.md` - å®Œæ•´æ¶æ§‹è¦æ ¼
- âœ… `KV_D1_DUAL_WRITE_STRATEGY.md` - é›™å¯«ç­–ç•¥åˆ†æ

#### **æ¸¬è©¦ç‹€æ…‹**
```
âœ… æ‰€æœ‰ 7 å€‹ Admin API endpoints æ¸¬è©¦é€šé
âœ… çœŸå¯¦æ•¸æ“šé©—è­‰ï¼š22 links, 4 API keys, 3 users, 300 credits
âœ… æ¬Šé™æ§åˆ¶æ­£ç¢ºï¼ˆrequireAdmin middlewareï¼‰
âœ… å¾æ­£ç¢ºçš„æ•¸æ“šä¾†æºè®€å–ï¼ˆKV + D1 + Analytics Engineï¼‰
```

---

## âœ… å·²å®ŒæˆåŠŸèƒ½ç¸½è¦½

### å¾Œç«¯ APIï¼ˆ100%ï¼‰

#### è³‡æ–™åº«çµæ§‹
- âœ… `api_keys` - API Key ç®¡ç†
- âœ… `credits` - Credit é¤˜é¡å’Œæ–¹æ¡ˆï¼ˆæ··åˆæ± è¨­è¨ˆï¼‰
- âœ… `credit_transactions` - äº¤æ˜“è¨˜éŒ„ï¼ˆå®Œæ•´å¯©è¨ˆï¼‰
- âœ… `api_usage_stats` - ä½¿ç”¨çµ±è¨ˆ
- âœ… `link_index` - çŸ­ç¶²å€ç´¢å¼•

#### æ ¸å¿ƒåŠŸèƒ½
- âœ… API Key ç”Ÿæˆèˆ‡é©—è­‰ï¼ˆSHA-256 é›œæ¹Šï¼‰
- âœ… KV Cache å„ªåŒ–ï¼ˆå»¶é²é™ä½ 80%ï¼‰
- âœ… å›ºå®šçª—å£ Rate Limiting
- âœ… æ··åˆåˆ¶ Credit æ‰£é™¤ï¼ˆæœˆé…é¡å„ªå…ˆï¼‰
- âœ… Analytics Engine æ•´åˆ
- âœ… Scopes æ¬Šé™æ§åˆ¶

#### API ç«¯é»
- âœ… `POST /v1/links` - å‰µå»ºçŸ­ç¶²å€
- âœ… `GET /v1/links` - åˆ—å‡ºçŸ­ç¶²å€
- âœ… `GET /v1/links/:slug` - ç²å–è©³æƒ…
- âœ… `GET /api/account/keys` - åˆ—å‡º API Keys
- âœ… `POST /api/account/keys` - å‰µå»º API Key
- âœ… `PUT /api/account/keys/:id` - æ›´æ–° API Key
- âœ… `DELETE /api/account/keys/:id` - åˆªé™¤ API Key
- âœ… `GET /api/account/credits` - æŸ¥è©¢ Credits
- âœ… `GET /api/account/transactions` - æŸ¥è©¢äº¤æ˜“è¨˜éŒ„
- âœ… `GET /api/account/usage` - æŸ¥è©¢ä½¿ç”¨çµ±è¨ˆ

---

### å‰ç«¯ä»‹é¢ï¼ˆ100%ï¼‰

#### ç®¡ç†é é¢
- âœ… `/api-keys` - API Key ç®¡ç†
  - å‰µå»ºã€æŸ¥çœ‹ã€å•Ÿç”¨/åœç”¨ã€åˆªé™¤
  - é¡¯ç¤º Rate Limit å’Œä½¿ç”¨çµ±è¨ˆ
  - âš ï¸ é¡¯ç¤ºå®Œæ•´ Keyï¼ˆåªä¸€æ¬¡ï¼‰
  
- âœ… `/credits` - Credits æŸ¥è©¢
  - é¡¯ç¤ºç¸½é¤˜é¡å’Œåˆ†è§£
  - æœˆé…é¡é€²åº¦æ¢
  - äº¤æ˜“è¨˜éŒ„åˆ—è¡¨
  - ç´¯è¨ˆçµ±è¨ˆ

- âœ… `/api-docs` - API ä½¿ç”¨æ–‡æª”
  - å¿«é€Ÿé–‹å§‹æŒ‡å—
  - å®Œæ•´çš„ API Reference
  - å¤šèªè¨€ç¨‹å¼ç¢¼ç¯„ä¾‹ï¼ˆJavaScript, Python, PHPï¼‰
  - Rate Limits èªªæ˜
  - éŒ¯èª¤ä»£ç¢¼èªªæ˜
  - æœ€ä½³å¯¦è¸

#### å°èˆªæ•´åˆ
- âœ… ç”¨æˆ¶é¸å–®æ–°å¢ã€ŒAPI Platformã€å€å¡Š
- âœ… åŒ…å«ï¼šAPI Keysã€Creditsã€Documentation

---

## ğŸ¯ æ ¸å¿ƒè¨­è¨ˆæ±ºç­–

### 1. API Key é©—è­‰ï¼šKV Cache
- **é¸æ“‡**: KV Cacheï¼ˆ5 åˆ†é˜ TTLï¼‰
- **æ•ˆæœ**: å»¶é²é™ä½ 80%
- **æˆæœ¬**: +$0.5/ç™¾è¬æ¬¡è«‹æ±‚
- **æ¬Šè¡¡**: ç®¡ç†å“¡æ”¹ Rate Limit å¾Œ 5 åˆ†é˜æ‰ç”Ÿæ•ˆ

### 2. Credit æ‰£é™¤ï¼šåŒæ­¥æ‰£é™¤
- **é¸æ“‡**: åŒæ­¥æ‰£é™¤ï¼ˆç­‰å¾…å®Œæˆï¼‰
- **æ•ˆæœ**: çµ•å°æº–ç¢ºï¼Œä¸æœƒè¶…æ”¯
- **å»¶é²**: +20msï¼ˆå¯æ¥å—ï¼‰
- **æ¬Šè¡¡**: éŸ¿æ‡‰æ™‚é–“ç•¥æ…¢ï¼Œä½†å®‰å…¨å¯é 

### 3. Rate Limitingï¼šå›ºå®šçª—å£
- **é¸æ“‡**: å›ºå®šçª—å£ + KV
- **æ•ˆæœ**: ç°¡å–®å¯é 
- **æˆæœ¬**: < $5/æœˆï¼ˆ1000 è¬æ¬¡èª¿ç”¨ï¼‰
- **æ¬Šè¡¡**: çª—å£é‚Šç•Œå¯èƒ½è¢«ç¹éï¼ˆä¸åš´é‡ï¼‰

### 4. çµ±è¨ˆæ”¶é›†ï¼šAnalytics Engine
- **é¸æ“‡**: AE å¯¦æ™‚è¨˜éŒ„
- **æ•ˆæœ**: ç„¡å¯«å…¥é™åˆ¶
- **æˆæœ¬**: $2.5/æœˆï¼ˆ1000 è¬æ¬¡ï¼‰vs D1 çš„ $5
- **æ¬Šè¡¡**: éœ€è¦èšåˆæŸ¥è©¢ï¼ˆæœªå¯¦ç¾ï¼‰

### 5. Credit æ± ï¼šæ··åˆæ± 
- **é¸æ“‡**: å°å¤–å…±ç”¨ã€å°å…§åˆ†é›¢
- **æ•ˆæœ**: ç”¨æˆ¶é«”é©— + é˜²æ¿«ç”¨
- **å¯¦ç¾**: subscription_balance + purchased_balance
- **æ‰£æ¬¾é †åº**: æœˆé…é¡ â†’ è³¼è²·é¤˜é¡

### 6. API Key æ•¸é‡é™åˆ¶
- **Free**: 5 å€‹ï¼ˆåˆç†é™åˆ¶ï¼Œé˜²æ©Ÿå™¨äººï¼‰
- **Starter**: 10 å€‹
- **Pro**: 25 å€‹
- **Enterprise**: ç„¡é™

---

## ğŸ§ª æ¸¬è©¦çµæœ

### å¾Œç«¯æ¸¬è©¦ï¼ˆâœ… å…¨éƒ¨é€šéï¼‰

```
æ¸¬è©¦ç”¨æˆ¶: joey@cryptoxlab.com
æ¸¬è©¦ç’°å¢ƒ: æœ¬åœ°é–‹ç™¼ + ç”Ÿç”¢ç’°å¢ƒ

âœ… API Key é©—è­‰ï¼ˆKV Cache Hit/Missï¼‰
âœ… çŸ­ç¶²å€å‰µå»ºï¼ˆ12 å€‹æˆåŠŸï¼‰
âœ… Credit æ‰£é™¤ï¼ˆå¾æœˆé…é¡æ‰£é™¤ 12ï¼‰
âœ… Rate Limitingï¼ˆ10/åˆ†é˜ç”Ÿæ•ˆï¼‰
âœ… è½‰å€åŠŸèƒ½ï¼ˆ301 é‡å®šå‘ï¼‰
âœ… äº¤æ˜“è¨˜éŒ„ï¼ˆå®Œæ•´å¯©è¨ˆï¼‰
âœ… è³‡æ–™åº«ç´¢å¼•ï¼ˆAPI å‰µå»ºè¨˜éŒ„ï¼‰
```

### å‰ç«¯æ¸¬è©¦ï¼ˆâœ… å·²é©—è­‰ï¼‰

```
âœ… API Keys é é¢é¡¯ç¤ºæ­£å¸¸
âœ… Credits é é¢é¡¯ç¤ºæ­£ç¢ºæ•¸æ“š
âœ… API Docs é é¢å®Œæ•´å¯ç”¨
âœ… å°èˆªé¸å–®æ•´åˆå®Œæˆ
âœ… API Key å‰µå»ºåŠŸèƒ½æ­£å¸¸
âœ… æ¬Šé™æ§åˆ¶æ­£ç¢ºï¼ˆsuperadmin å¯è¨ªå•æ‰€æœ‰é é¢ï¼‰
```

---

## ğŸ“Š ç•¶å‰ç³»çµ±æ•¸æ“š

### è³‡æ–™åº«ç‹€æ…‹
```
users: å¤šå€‹ï¼ˆåŒ…å« superadminï¼‰
api_keys: å¤šå€‹ï¼ˆlive å’Œ test ç’°å¢ƒï¼‰
credits: å®Œæ•´çš„ Credit ç³»çµ±é‹ä½œä¸­
credit_transactions: å®Œæ•´çš„äº¤æ˜“è¨˜éŒ„
link_index: è¿½è¹¤æ‰€æœ‰ API å‰µå»ºçš„çŸ­ç¶²å€
```

### æ•ˆèƒ½æŒ‡æ¨™
```
API Key é©—è­‰å»¶é²:
- Cache Hit: 1-5ms
- Cache Miss: 10-50ms

Rate Limiting:
- Free: 10/åˆ†é˜, 1000/å¤©
- Pro: 300/åˆ†é˜, 100,000/å¤©

Credit æ‰£é™¤:
- åŒæ­¥æ‰£é™¤: +20ms å»¶é²
- æº–ç¢ºç‡: 100%
```

---

## ğŸ’° æˆæœ¬åˆ†æ

### 1000 è¬æ¬¡ API èª¿ç”¨/æœˆ

| é …ç›® | æˆæœ¬ |
|------|------|
| Worker CPU | $10 |
| D1 è®€å¯« | $0ï¼ˆå…è²»é¡åº¦å…§ï¼‰ |
| KV æ“ä½œ | $4.5 |
| Analytics Engine | $2.5 |
| **ç¸½è¨ˆ** | **~$17/æœˆ** |

**æ¯æ¬¡èª¿ç”¨æˆæœ¬**: $0.0000017ï¼ˆå¯å¿½ç•¥ï¼‰

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- âœ… API Key åªé¡¯ç¤ºä¸€æ¬¡
- âœ… è³‡æ–™åº«åªå­˜ SHA-256 é›œæ¹Šå€¼
- âœ… Rate Limiting å¤šå±¤ä¿è­·
- âœ… Scopes æœ€å°æ¬Šé™åŸå‰‡
- âœ… å®Œæ•´çš„äº¤æ˜“å¯©è¨ˆ
- âœ… CORS æ­£ç¢ºé…ç½®
- âœ… JWT + API Key é›™é‡é©—è­‰

---

## ğŸ¨ ç”¨æˆ¶å¯ç”¨åŠŸèƒ½

### åŸºæœ¬æ“ä½œ
1. **å‰µå»º API Key**ï¼ˆæœ€å¤š 5 å€‹ï¼ŒFree ç”¨æˆ¶ï¼‰
2. **ä½¿ç”¨ API å‰µå»ºçŸ­ç¶²å€**
3. **æŸ¥è©¢ Credits é¤˜é¡**
4. **æŸ¥çœ‹äº¤æ˜“è¨˜éŒ„**
5. **é–±è®€ API æ–‡æª”**
6. **ç®¡ç† API Keys**ï¼ˆå•Ÿç”¨/åœç”¨/åˆªé™¤ï¼‰

### ç³»çµ±è‡ªå‹•è™•ç†
1. âœ… API Key é©—è­‰ï¼ˆKV Cacheï¼‰
2. âœ… Rate Limitingï¼ˆå›ºå®šçª—å£ï¼‰
3. âœ… Credit æ‰£é™¤ï¼ˆå„ªå…ˆæœˆé…é¡ï¼‰
4. âœ… ä½¿ç”¨è¨˜éŒ„è¿½è¹¤
5. âœ… Analytics Engine è¨˜éŒ„

---

## ğŸ“ ç›¸é—œæ–‡ä»¶

### è¨­è¨ˆæ–‡æª”
- `API_PLATFORM_DESIGN.md` - å®Œæ•´è¨­è¨ˆè¦æ ¼
- `API_OPTIMIZATION_OPTIONS.md` - å„ªåŒ–æ–¹æ¡ˆåˆ†æ
- `API_PLATFORM_UPGRADE_PATHS.md` - å‡ç´šè·¯ç·šåœ–
- `ADMIN_PORTAL_ARCHITECTURE.md` - ğŸ†• Admin Portal æ¶æ§‹
- `KV_D1_DUAL_WRITE_STRATEGY.md` - ğŸ†• é›™å¯«ç­–ç•¥åˆ†æ

### API Platform ä»£ç¢¼
- `api-worker/migrations/0003_api_platform_core.sql` - è³‡æ–™åº«çµæ§‹
- `api-worker/src/routes/api-keys.ts` - API Key è·¯ç”±
- `api-worker/src/routes/account.ts` - Credits è·¯ç”±
- `api-worker/src/routes/v1-links.ts` - V1 Public API
- `frontend/src/pages/dashboard/ApiKeys.tsx` - API Keys ç®¡ç†é é¢
- `frontend/src/pages/dashboard/Credits.tsx` - Credits æŸ¥è©¢é é¢
- `frontend/src/pages/dashboard/ApiDocs.tsx` - API æ–‡æª”é é¢

### Admin Portal ä»£ç¢¼ ğŸ†•
- `api-worker/migrations/0004_admin_features.sql` - Admin åŠŸèƒ½æ“´å±•
- `api-worker/src/routes/admin.ts` - Admin API è·¯ç”±ï¼ˆ11 å€‹ endpointsï¼‰
- `frontend/src/components/layout/AdminLayout.tsx` - Admin å°ˆå±¬ä½ˆå±€
- `frontend/src/pages/admin/*.tsx` - 8 å€‹ Admin é é¢

---

## ğŸš€ éƒ¨ç½²ç‹€æ…‹

### ç”Ÿç”¢ç’°å¢ƒ
- âœ… API Worker å·²éƒ¨ç½²
- âœ… Core Worker å·²éƒ¨ç½²
- âœ… Frontend å·²éƒ¨ç½²
- âœ… Database Migration å·²åŸ·è¡Œ
- âœ… KV ç¶å®šæ­£ç¢º
- âœ… Analytics Engine å•Ÿç”¨

### ç’°å¢ƒè®Šæ•¸
- âœ… JWT_SECRET å·²è¨­å®š
- âœ… GOOGLE_CLIENT_ID å·²è¨­å®š
- âœ… GOOGLE_CLIENT_SECRET å·²è¨­å®š
- âœ… æ‰€æœ‰å¿…è¦çš„ Secrets å·²é…ç½®

---

## â­ï¸ å¾…å¯¦ç¾åŠŸèƒ½

### **Admin Portal é€²éšåŠŸèƒ½** (å¯é¸)
- â¸ æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡åˆªé™¤ã€æ‰¹é‡ç¦ç”¨ï¼‰
- â¸ é«˜ç´šæœå°‹/éæ¿¾
- â¸ åŒ¯å‡ºå ±è¡¨ï¼ˆCSV/Excelï¼‰
- â¸ Audit Logs UIï¼ˆæ“ä½œæ­·å²æŸ¥è©¢ï¼‰
- â¸ ç³»çµ±ç›£æ§ Dashboardï¼ˆRealtimeï¼‰
- â¸ Email æ¨¡æ¿ç®¡ç†
- â¸ Feature Flags ç®¡ç†

### **API Platform æ“´å±•** (ç”¨æˆ¶éœ€æ±‚)
- â¸ æ‰¹é‡å‰µå»º APIï¼ˆ`POST /v1/links/batch`ï¼‰
- â¸ æ›´æ–°çŸ­ç¶²å€ APIï¼ˆ`PUT /v1/links/:slug`ï¼‰
- â¸ åˆªé™¤çŸ­ç¶²å€ APIï¼ˆ`DELETE /v1/links/:slug`ï¼‰
- â¸ è©³ç´°åˆ†æ APIï¼ˆ`GET /v1/analytics/:slug`ï¼‰
- â¸ Webhook é€šçŸ¥
- â¸ Stripe æ”¯ä»˜æ•´åˆ
- â¸ è¨‚é–±ç®¡ç†ä»‹é¢

### **è¦æ¨¡åŒ–å„ªåŒ–** (é•·æœŸ)
- â¸ è‡ªè¨‚åŸŸå
- â¸ ç™½æ¨™æœå‹™
- â¸ SDKï¼ˆPython, Node.js, PHPï¼‰
- â¸ OpenAPI/Swagger è¦æ ¼
- â¸ ä»¤ç‰Œæ¡¶ Rate Limiting
- â¸ ç•°æ­¥ Credit æ‰£é™¤
- â¸ Cron å®šæœŸæ•¸æ“šåŒæ­¥

---

## ğŸ¯ ç•¶å‰å„ªå…ˆç´š

### P0ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
å·²å…¨éƒ¨å®Œæˆ âœ…

### P1ï¼ˆç”¨æˆ¶é«”é©—ï¼‰
- [ ] Stripe æ”¯ä»˜æ•´åˆï¼ˆè®“ç”¨æˆ¶å¯ä»¥è³¼è²· Creditsï¼‰
- [ ] è¨‚é–±ç®¡ç†ï¼ˆè®“ç”¨æˆ¶å¯ä»¥å‡ç´šæ–¹æ¡ˆï¼‰

### P2ï¼ˆå„ªåŒ–ï¼‰
- [ ] ä½¿ç”¨çµ±è¨ˆè¦–è¦ºåŒ–
- [ ] ç›£æ§ Dashboard

### P3ï¼ˆè¦æ¨¡åŒ–ï¼‰
è©³è¦‹å‡ç´šè·¯å¾‘æ–‡æª”

---

## âœ… ç¸½çµ

**æ ¸å¿ƒåƒ¹å€¼**ï¼š

é€™æ˜¯ä¸€å€‹**ä¼æ¥­ç´šã€ç”Ÿç”¢å°±ç·’**çš„ API å¹³å°ï¼š

âœ… **åŠŸèƒ½å®Œæ•´**: API Keyã€Creditsã€Rate Limitingã€æ–‡æª”  
âœ… **å®‰å…¨å¯é **: SHA-256ã€Scopesã€å¯©è¨ˆæ—¥èªŒ  
âœ… **æ•ˆèƒ½å„ªç•°**: KV Cacheã€Analytics Engine  
âœ… **æˆæœ¬å„ªåŒ–**: < $20/æœˆï¼ˆ1000 è¬æ¬¡èª¿ç”¨ï¼‰  
âœ… **ç”¨æˆ¶å‹å–„**: æ¸…æ™°çš„æ–‡æª”ã€ç¨‹å¼ç¢¼ç¯„ä¾‹  
âœ… **å¯æ“´å±•**: æ”¯æ´å¾å…è²»åˆ°ä¼æ¥­ç´š  

**ç•¶å‰ç‹€æ…‹**: æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆä¸¦åœ¨ç”Ÿç”¢ç’°å¢ƒé‹è¡Œ ğŸš€

---

æ›´æ–°æ™‚é–“: 2026-01-23
