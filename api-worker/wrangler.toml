#:schema node_modules/wrangler/config-schema.json
name = "oao-to-api"
main = "src/index.ts"
compatibility_date = "2024-09-28"
compatibility_flags = ["nodejs_compat"]

# 本地開發設定
# 注意：Wrangler 4.x 不支援 persist_to  
# 多 Worker 共享 KV 的解決方案見 MULTI_WORKER_LOCAL_DEV_GUIDE.md

# 靜態資源（可選，主要給前端用）
# [assets]
# directory = "./public"

# 自訂域名路由（本地開發時註解掉）
# routes = [
# 	{ pattern = "oao.to", custom_domain = true }
# ]

# Smart Placement（可選）
# [placement]
# mode = "smart"

# Workers KV - 短網址存儲
[[kv_namespaces]]
binding = "LINKS"
id = "8f133853496a4bdfb8151a39dd251518"  # 與 core-worker 相同 ID
# 本地開發：Miniflare 自動共享（相同 ID）
# 生產部署：需要創建獨立的 prod KV

# D1 Database - 用戶資料
[[d1_databases]]
binding = "DB"
database_name = "oao-to-db"
database_id = "db9693c9-d2de-43b7-ad28-e2211e736e16"

# Analytics Engine - 點擊追蹤
[[analytics_engine_datasets]]
binding = "TRACKER"
dataset = "link_clicks"

# ===== 生產環境 =====
[env.production]
routes = [{ pattern = "api.oao.to", custom_domain = true }]

[[env.production.kv_namespaces]]
binding = "LINKS"
id = "cb616d868c134b1c9e5e6ef54afb3f64"

[[env.production.d1_databases]]
binding = "DB"
database_name = "oao-to-prod"
database_id = "bc49236e-acc9-499b-ba68-6aa90a000444"
migrations_dir = "migrations"

[[env.production.analytics_engine_datasets]]
binding = "TRACKER"
dataset = "link_clicks"