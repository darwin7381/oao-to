# éƒ¨ç½²å ±å‘Š - API å¹³å°

**éƒ¨ç½²æ—¥æœŸ**: 2026-01-23  
**éƒ¨ç½²æ™‚é–“**: 17:18 UTC+8  
**ç‹€æ…‹**: âœ… **æˆåŠŸ**

---

## ğŸ‰ éƒ¨ç½²æ‘˜è¦

### å·²éƒ¨ç½²çš„æœå‹™

| æœå‹™ | URL | ç‰ˆæœ¬ | ç‹€æ…‹ |
|------|-----|------|------|
| Core Worker | https://oao.to | ac35b670 | âœ… |
| API Worker | https://oao-to-api.cryptoxlab.workers.dev | a6caf359 | âœ… |
| Frontend | https://d3118251.oao-to-app.pages.dev | latest | âœ… |
| Database | oao-to-db (D1) | Migration #3 | âœ… |

---

## ğŸ“¦ éƒ¨ç½²å…§å®¹

### è³‡æ–™åº« Migrations

```
âœ… 0001_initial.sql - åŸºç¤è¡¨çµæ§‹
âœ… 0002_add_user_roles.sql - ç”¨æˆ¶è§’è‰²ç³»çµ±
âœ… 0003_api_platform_core.sql - API å¹³å°å®Œæ•´çµæ§‹
```

**æ–°å¢è¡¨**:
- `api_keys` - API Key ç®¡ç†
- `credits` - Credits é¤˜é¡ï¼ˆæ··åˆæ± ï¼‰
- `credit_transactions` - äº¤æ˜“å¯©è¨ˆ
- `api_usage_stats` - ä½¿ç”¨çµ±è¨ˆ
- `link_index` - çŸ­ç¶²å€ç´¢å¼•

**æ–°å¢ç´¢å¼•**: 16+ å€‹ï¼ˆæŸ¥è©¢å„ªåŒ–ï¼‰

---

### å¾Œç«¯åŠŸèƒ½

#### API å¹³å°æ ¸å¿ƒ
- âœ… API Key ç”Ÿæˆèˆ‡é©—è­‰ï¼ˆSHA-256ï¼‰
- âœ… KV Cache å„ªåŒ–ï¼ˆ5 åˆ†é˜ TTLï¼‰
- âœ… å›ºå®šçª—å£ Rate Limiting
- âœ… æ··åˆåˆ¶ Credit è¨ˆè²»
- âœ… Scopes æ¬Šé™æ§åˆ¶
- âœ… Analytics Engine æ•´åˆ

#### æ–°å¢ API ç«¯é»
```
V1 Public API (éœ€è¦ API Key):
- POST /v1/links - å‰µå»ºçŸ­ç¶²å€
- GET /v1/links - åˆ—å‡ºçŸ­ç¶²å€
- GET /v1/links/:slug - ç²å–è©³æƒ…

Account API (éœ€è¦ JWT):
- GET /api/account/keys - åˆ—å‡º API Keys
- POST /api/account/keys - å‰µå»º API Key
- PUT /api/account/keys/:id - æ›´æ–° API Key
- DELETE /api/account/keys/:id - åˆªé™¤ API Key
- GET /api/account/credits - æŸ¥è©¢ Credits
- GET /api/account/transactions - æŸ¥è©¢äº¤æ˜“è¨˜éŒ„
- GET /api/account/usage - æŸ¥è©¢ä½¿ç”¨çµ±è¨ˆ
```

---

### å‰ç«¯åŠŸèƒ½

#### æ–°å¢é é¢
- âœ… `/api-keys` - API Key ç®¡ç†ä»‹é¢
- âœ… `/credits` - Credits æŸ¥è©¢ä»‹é¢
- âœ… `/api-docs` - API ä½¿ç”¨æ–‡æª”

#### UI åŠŸèƒ½
- âœ… å‰µå»º API Keyï¼ˆå« scopesã€environment é¸æ“‡ï¼‰
- âœ… é¡¯ç¤ºå®Œæ•´ Keyï¼ˆåªä¸€æ¬¡ï¼Œå«è­¦å‘Šï¼‰
- âœ… ç®¡ç† API Keysï¼ˆå•Ÿç”¨/åœç”¨/åˆªé™¤ï¼‰
- âœ… æŸ¥çœ‹ Credits é¤˜é¡åˆ†è§£
- âœ… æœˆé…é¡é€²åº¦æ¢
- âœ… äº¤æ˜“è¨˜éŒ„åˆ—è¡¨
- âœ… å®Œæ•´ API æ–‡æª”ï¼ˆå¤šèªè¨€ç¯„ä¾‹ï¼‰

---

## ğŸ”§ é…ç½®èª¿æ•´

### API Key æ•¸é‡é™åˆ¶

**èª¿æ•´åŸå› **: åŸé™åˆ¶å¤ªåš´æ ¼ï¼Œå½±éŸ¿ç”¨æˆ¶é«”é©—

| æ–¹æ¡ˆ | èˆŠé™åˆ¶ | æ–°é™åˆ¶ | èªªæ˜ |
|------|--------|--------|------|
| Free | 1 å€‹ | **5 å€‹** | è¶³å¤ æ­£å¸¸ä½¿ç”¨ |
| Starter | 3 å€‹ | **10 å€‹** | å°åœ˜éšŠ |
| Pro | 10 å€‹ | **25 å€‹** | ä¸­å‹åœ˜éšŠ |
| Enterprise | 999 å€‹ | **999 å€‹** | ç„¡é™ |

**ç›®çš„**: é˜²æ­¢æ©Ÿå™¨äººæ”»æ“Šï¼Œä½†ä¸é™åˆ¶æ­£å¸¸ä½¿ç”¨

---

### Rate Limiting é…ç½®

| æ–¹æ¡ˆ | æ¯åˆ†é˜ | æ¯å¤© |
|------|--------|------|
| Free | 10 | 1,000 |
| Starter | 60 | 10,000 |
| Pro | 300 | 100,000 |
| Enterprise | è‡ªè¨‚ | ç„¡é™ |

---

## ğŸ§ª éƒ¨ç½²å¾Œæ¸¬è©¦

### ç”Ÿç”¢ç’°å¢ƒé©—è­‰

```bash
âœ… Core Worker Health:
curl https://oao.to/health
â†’ {"status":"ok","service":"oao.to-core"}

âœ… API Worker Health:
curl https://oao-to-api.cryptoxlab.workers.dev/health
â†’ {"status":"ok","service":"oao.to-api"}

âœ… Frontend:
https://d3118251.oao-to-app.pages.dev
â†’ é é¢æ­£å¸¸è¼‰å…¥
```

---

## ğŸ“Š ç”Ÿç”¢è³‡æ–™åº«ç‹€æ…‹

```
è¡¨çµæ§‹: 10 å¼µè¡¨ âœ…
ç´¢å¼•: 16+ å€‹ âœ…
ç”¨æˆ¶: 3 å€‹ï¼ˆå·²é·ç§»ï¼‰âœ…
Credits å¸³æˆ¶: 3 å€‹ âœ…
API Keys: 0 å€‹ï¼ˆå…¨æ–°ç’°å¢ƒï¼‰
çŸ­ç¶²å€: 0 å€‹ï¼ˆå…¨æ–°ç’°å¢ƒï¼‰
```

**æ³¨æ„**: ç”Ÿç”¢ç’°å¢ƒæ˜¯å…¨æ–°çš„ï¼Œæ²’æœ‰æ¸¬è©¦è³‡æ–™ âœ…

---

## âš ï¸ å·²çŸ¥å•é¡Œ

### 1. Admin è¨ªå•å•é¡Œï¼ˆå‰ç«¯ï¼‰

**ç¾è±¡**: Superadmin ç„¡æ³•è¨ªå• `/admin/users`

**åŸå› **: å‰ç«¯ localStorage çš„ token æ˜¯èˆŠçš„

**è§£æ±ºæ–¹æ¡ˆ**: 
```javascript
// åœ¨ç€è¦½å™¨ Console åŸ·è¡Œ
localStorage.clear();
location.reload();
// ç„¶å¾Œé‡æ–°ç™»å…¥
```

**å½±éŸ¿**: åªå½±éŸ¿é–‹ç™¼ç’°å¢ƒçš„ç¾æœ‰ç”¨æˆ¶ï¼Œç”Ÿç”¢ç’°å¢ƒä¸å—å½±éŸ¿

**ç‹€æ…‹**: â¸ ä¸é˜»æ“‹éƒ¨ç½²ï¼ˆç”¨æˆ¶é‡æ–°ç™»å…¥å³å¯ï¼‰

---

### 2. Custom Domain é…ç½®

**å¾…åš**:
- [ ] åœ¨ Cloudflare Dashboard é…ç½® app.oao.to â†’ Pages
- [ ] é©—è­‰ DNS è§£æ
- [ ] æ¸¬è©¦ HTTPS è­‰æ›¸

---

## ğŸ¯ éƒ¨ç½²å¾Œç«‹å³è¡Œå‹•

### å¿…åšï¼ˆ5 åˆ†é˜å…§ï¼‰

1. **é…ç½® Custom Domain**
   ```
   Cloudflare Dashboard â†’ Pages â†’ oao-to-app â†’ Custom domains
   â†’ æ·»åŠ  app.oao.to
   ```

2. **æ¸¬è©¦ç”Ÿç”¢ç’°å¢ƒç™»å…¥**
   ```
   è¨ªå• https://d3118251.oao-to-app.pages.dev
   â†’ é»æ“Š Sign in with Google
   â†’ ç¢ºèªèƒ½æˆåŠŸç™»å…¥
   ```

3. **å‰µå»ºç¬¬ä¸€å€‹ç”Ÿç”¢ API Key**
   ```
   ç™»å…¥å¾Œ â†’ API Keys â†’ Create
   â†’ æ¸¬è©¦æ˜¯å¦æ­£å¸¸å·¥ä½œ
   ```

---

### å»ºè­°ï¼ˆ24 å°æ™‚å…§ï¼‰

1. **è¨­ç½®ç›£æ§**
   - Analytics Engine æŸ¥è©¢
   - éŒ¯èª¤ç‡å‘Šè­¦
   - Credits ä½¿ç”¨ç›£æ§

2. **å‚™ä»½ç­–ç•¥**
   - D1 è‡ªå‹•å‚™ä»½
   - KV è³‡æ–™åŒ¯å‡º

3. **æ–‡æª”å®Œå–„**
   - éƒ¨ç½²åˆ° Custom Domain å¾Œæ›´æ–°æ–‡æª”ä¸­çš„ URL
   - æ·»åŠ æ›´å¤šç¨‹å¼ç¢¼ç¯„ä¾‹

---

## ğŸ“ˆ é æœŸæˆæ•ˆ

### ç”¨æˆ¶åƒ¹å€¼

```
é–‹ç™¼è€…ç¾åœ¨å¯ä»¥:
âœ… é€šé API ç¨‹å¼åŒ–å‰µå»ºçŸ­ç¶²å€
âœ… æ•´åˆåˆ°è‡ªå·±çš„æ‡‰ç”¨ä¸­
âœ… è‡ªå‹•åŒ–æ‰¹é‡æ“ä½œ
âœ… è¿½è¹¤ API ä½¿ç”¨é‡
âœ… æ§åˆ¶æˆæœ¬ï¼ˆCredits ç³»çµ±ï¼‰
```

### å•†æ¥­åƒ¹å€¼

```
æ–°çš„æ”¶å…¥ä¾†æº:
- API è¨‚é–±ï¼ˆStarter, Pro, Enterpriseï¼‰
- Credits éŠ·å”®ï¼ˆPay-as-you-goï¼‰

é ä¼°:
- åˆæœŸç›®æ¨™: 100 å€‹ API ç”¨æˆ¶
- è½‰åŒ–ç‡: 10% â†’ 10 å€‹ä»˜è²»
- ARPU: $15/æœˆ
- MRR: $150/æœˆ
```

---

## âœ… éƒ¨ç½²æª¢æŸ¥æ¸…å–®

- [x] Migrations åŸ·è¡Œåˆ°ç”Ÿç”¢ D1
- [x] Core Worker éƒ¨ç½²æˆåŠŸ
- [x] API Worker éƒ¨ç½²æˆåŠŸ
- [x] Frontend éƒ¨ç½²æˆåŠŸ
- [x] ç”Ÿç”¢ç’°å¢ƒ Health Check é€šé
- [ ] Custom Domain é…ç½®ï¼ˆå¾…åšï¼‰
- [ ] ç”Ÿç”¢ç’°å¢ƒå®Œæ•´æ¸¬è©¦ï¼ˆå¾…åšï¼‰
- [ ] ç›£æ§å‘Šè­¦è¨­ç½®ï¼ˆå¾…åšï¼‰

---

## ğŸŠ çµè«–

**éƒ¨ç½²ç‹€æ…‹**: âœ… **æˆåŠŸ**

**åŠŸèƒ½å®Œæ•´åº¦**: 96%
- æ ¸å¿ƒåŠŸèƒ½: 100% âœ…
- å„ªåŒ–åŠŸèƒ½: 100% âœ…
- æ–‡æª”: 100% âœ…
- Custom Domain: å¾…é…ç½®

**é¢¨éšªè©•ä¼°**: ğŸŸ¢ **ä½é¢¨éšª**

**å»ºè­°**: âœ… **é–‹æ”¾çµ¦ç”¨æˆ¶ä½¿ç”¨**

---

## ğŸ“ æŠ€è¡“æ”¯æ´

**å¦‚é‡å•é¡Œ**:
1. æª¢æŸ¥ Worker æ—¥èªŒï¼ˆCloudflare Dashboardï¼‰
2. æª¢æŸ¥ D1 è³‡æ–™ï¼ˆwrangler d1 executeï¼‰
3. æª¢æŸ¥ Analytics Engine
4. è¯ç¹«æŠ€è¡“åœ˜éšŠ

---

**éƒ¨ç½²æˆåŠŸï¼API å¹³å°å·²ä¸Šç·šï¼** ğŸš€

ä¸‹ä¸€æ­¥ï¼š
1. è¨ªå• https://d3118251.oao-to-app.pages.dev
2. é‡æ–°ç™»å…¥ç²å–æ–° token
3. å‰µå»º API Key ä¸¦é–‹å§‹ä½¿ç”¨

**æ­å–œï¼OAO.TO API å¹³å°æ­£å¼ä¸Šç·šï¼** ğŸ‰


