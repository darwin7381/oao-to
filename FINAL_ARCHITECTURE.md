# OAO.TO æœ€çµ‚æ¶æ§‹æ–‡æª”

**å°ˆæ¡ˆ**ï¼šOAO.TO - å°ˆæ¥­çŸ­ç¶²å€æœå‹™  
**ç‰ˆæœ¬**ï¼šV1.0  
**æ›´æ–°**ï¼š2026-01-14  

---

## ğŸ¯ æ¶æ§‹æ¦‚è¦½

### **ä¸‰å±¤å¾®æœå‹™æ¶æ§‹**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Cloudflare Edge Network (300+ è³‡æ–™ä¸­å¿ƒ)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ oao.to  â”‚     â”‚api.oao.toâ”‚    â”‚app.oao.to â”‚
   â”‚ (Core)  â”‚     â”‚  (API)   â”‚    â”‚(Frontend) â”‚
   â”‚ Worker  â”‚     â”‚  Worker  â”‚    â”‚  Pages    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                â”‚                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚     å…±äº«æ•¸æ“šå±¤        â”‚
              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
              â”‚ Workers KV          â”‚
              â”‚ D1 Database         â”‚
              â”‚ Analytics Engine    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ æœå‹™è·è²¬è©³è§£

### **Service 1: oao.to (Core Worker)**

#### **å–®ä¸€è·è²¬**
ç´”ç²¹çš„çŸ­ç¶²å€é‡å®šå‘æœå‹™

#### **è·¯ç”±**
```typescript
GET /:slug        // çŸ­ç¶²å€é‡å®šå‘ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
GET /health       // å¥åº·æª¢æŸ¥
```

#### **è³‡æºç¶å®š**
```toml
[[kv_namespaces]]
binding = "LINKS"
id = "..."        // åªè®€å–ï¼Œä¸å¯«å…¥

[[analytics_engine_datasets]]
binding = "TRACKER"
dataset = "link_clicks"
```

#### **ç¨‹å¼ç¢¼ç‰¹é»**
- æ¥µè‡´ç°¡å–®ï¼š< 100 è¡Œç¨‹å¼ç¢¼
- ç„¡æ¥­å‹™é‚è¼¯
- åªåšï¼šKV.get() â†’ redirect()

#### **æ€§èƒ½æŒ‡æ¨™**
- å»¶é²ï¼š< 5msï¼ˆåªæœ‰ KV è®€å–ï¼‰
- å¯ç”¨æ€§ï¼š99.99%+ï¼ˆç„¡è¤‡é›œé‚è¼¯ï¼‰

#### **ç‚ºä»€éº¼ç¨ç«‹ï¼Ÿ**
1. **é¿å…è·¯ç”±è¡çª**
   - ç”¨æˆ¶å¯ä»¥å‰µå»ºä»»æ„ slugï¼ˆåŒ…æ‹¬ /api, /dashboard ç­‰ï¼‰
   - å¦‚æœæ··åœ¨ä¸€èµ·ï¼Œæœƒèˆ‡ API è·¯ç”±è¡çª

2. **æ€§èƒ½æœ€ä½³åŒ–**
   - æ ¸å¿ƒé‡å®šå‘æœå‹™ä¸å—å…¶ä»–é‚è¼¯å½±éŸ¿
   - æ¥µè‡´ç°¡å–® = æ¥µè‡´å¿«é€Ÿ

3. **é«˜å¯ç”¨æ€§**
   - æœ€ç°¡å–®çš„ç¨‹å¼ç¢¼æœ€ä¸å®¹æ˜“å‡ºéŒ¯
   - æ ¸å¿ƒæœå‹™ç¨ç«‹ï¼Œä¸å— API æ›´æ–°å½±éŸ¿

---

### **Service 2: api.oao.to (API Worker)**

#### **è·è²¬**
æ‰€æœ‰æ¥­å‹™é‚è¼¯ã€æ•¸æ“šç®¡ç†ã€ç”¨æˆ¶èªè­‰

#### **è·¯ç”±**

**å…¬é–‹ç«¯é»**ï¼ˆç„¡éœ€èªè­‰ï¼‰ï¼š
```typescript
POST /shorten             // å¿«é€Ÿå‰µå»ºçŸ­ç¶²å€
GET  /test-list          // åˆ—è¡¨ï¼ˆé–‹ç™¼ç”¨ï¼‰
```

**èªè­‰ç«¯é»**ï¼š
```typescript
GET  /api/auth/google              // Google OAuth ç™»å…¥
GET  /api/auth/google/callback     // OAuth å›èª¿
GET  /api/auth/me                  // ç²å–ç•¶å‰ç”¨æˆ¶
```

**çŸ­ç¶²å€ç®¡ç†**ï¼ˆéœ€ JWT èªè­‰ï¼‰ï¼š
```typescript
POST   /api/links          // å‰µå»º
GET    /api/links          // åˆ—è¡¨
GET    /api/links/:slug    // è©³æƒ…
PUT    /api/links/:slug    // æ›´æ–°
DELETE /api/links/:slug    // åˆªé™¤
```

**åˆ†æåŠŸèƒ½**ï¼ˆéœ€ JWT èªè­‰ï¼‰ï¼š
```typescript
GET /api/analytics/:slug           // å–®å€‹çŸ­ç¶²å€åˆ†æ
GET /api/analytics/summary/all     // ç¸½è¦½çµ±è¨ˆ
```

#### **è³‡æºç¶å®š**
```toml
[[kv_namespaces]]
binding = "LINKS"
id = "..."        // è®€å¯«æ¬Šé™

[[d1_databases]]
binding = "DB"
database_id = "..."
migrations_dir = "migrations"

[[analytics_engine_datasets]]
binding = "TRACKER"
dataset = "link_clicks"
```

#### **ç¨‹å¼ç¢¼çµ„ç¹”**
```
api-worker/src/
â”œâ”€â”€ index.ts           // ä¸»å…¥å£ã€è·¯ç”±
â”œâ”€â”€ types.ts           // TypeScript å®šç¾©
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ auth.ts        // Google OAuth
â”‚   â”œâ”€â”€ links.ts       // çŸ­ç¶²å€ CRUD
â”‚   â””â”€â”€ analytics.ts   // åˆ†ææŸ¥è©¢
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ auth.ts        // JWT é©—è­‰
â””â”€â”€ utils/
    â”œâ”€â”€ analytics.ts   // Analytics Engine å·¥å…·
    â””â”€â”€ slug-generator.ts  // Slug ç”Ÿæˆå™¨
```

---

### **Service 3: app.oao.to (Frontend - Pages)**

#### **è·è²¬**
ç´”å‰ç«¯ UIï¼Œç„¡å¾Œç«¯é‚è¼¯

#### **é é¢**
```typescript
/                      // é¦–é ï¼ˆå¿«é€Ÿç¸®çŸ­ï¼‰
/dashboard             // å„€è¡¨æ¿ï¼ˆç®¡ç†çŸ­ç¶²å€ï¼‰
/analytics/:slug       // åˆ†æé é¢ï¼ˆè©³ç´°åœ–è¡¨ï¼‰
/auth/callback         // OAuth å›èª¿è™•ç†
```

#### **æŠ€è¡“æ£§**
- React 18
- React Router 6
- Vite
- TailwindCSS
- Rechartsï¼ˆåœ–è¡¨ï¼‰

#### **API èª¿ç”¨**
```typescript
// å…¨éƒ¨èª¿ç”¨ API Worker
const API_BASE = 'https://api.oao.to/api';

// çŸ­ç¶²å€æŒ‡å‘ Core Worker
const SHORT_URL = 'https://oao.to';
```

#### **é‡è¦**
- âŒ ä¸ç¶å®šä»»ä½• Workers è³‡æº
- âŒ ä¸è¨ªå• KVã€D1
- âœ… ç´”éœæ…‹å‰ç«¯
- âœ… åªé€šé HTTP API èˆ‡å¾Œç«¯é€šä¿¡

---

## ğŸ”„ å®Œæ•´æ•¸æ“šæµ

### **æµç¨‹ 1ï¼šç”¨æˆ¶å‰µå»ºçŸ­ç¶²å€**

```
1. ç”¨æˆ¶åœ¨ app.oao.to è¼¸å…¥é•·ç¶²å€
   â†“
2. Frontend ç™¼é€è«‹æ±‚
   POST https://api.oao.to/shorten
   Body: { url: "https://example.com/very/long/url" }
   â†“
3. API Worker è™•ç†
   - ç”Ÿæˆéš¨æ©Ÿ slugï¼ˆä¾‹å¦‚ï¼šabc123ï¼‰
   - æˆ–é©—è­‰è‡ªè¨‚ slug
   - æª¢æŸ¥å”¯ä¸€æ€§
   â†“
4. å¯«å…¥ Workers KV
   Key: "link:abc123"
   Value: { slug, url, userId, createdAt, ... }
   â†“
5. å¯«å…¥ D1ï¼ˆå¯é¸ï¼Œæ–¹ä¾¿æŸ¥è©¢ï¼‰
   INSERT INTO links (slug, url, user_id, ...)
   â†“
6. å›å‚³çµ¦å‰ç«¯
   { slug: "abc123", shortUrl: "https://oao.to/abc123" }
   â†“
7. å‰ç«¯é¡¯ç¤ºçµæœ
   ç”¨æˆ¶å¯è¤‡è£½å’Œåˆ†äº«
```

---

### **æµç¨‹ 2ï¼šè¨ªå•çŸ­ç¶²å€**

```
1. ç”¨æˆ¶/ç€è¦½å™¨è¨ªå•
   GET https://oao.to/abc123
   â†“
2. Cloudflare DNS è·¯ç”±åˆ° Core Worker
   â†“
3. Core Worker è™•ç†
   - è§£æ slug: "abc123"
   - KV.get('link:abc123')
   â†“
4. å¾ KV ç²å–æ•¸æ“š
   { url: "https://example.com/...", userId: "...", ... }
   â†“
5. èƒŒæ™¯è¿½è¹¤ï¼ˆä¸é˜»å¡ï¼‰
   Analytics Engine.writeDataPoint({
     blobs: [slug, url, country, city, ...],
     doubles: [timestamp, lat, lng],
     indexes: [slug, userId]
   })
   â†“
6. ç«‹å³é‡å®šå‘
   301 Redirect â†’ https://example.com/...
   â†“
7. ç”¨æˆ¶åˆ°é”ç›®æ¨™ç¶²ç«™

ç¸½å»¶é²ï¼š< 10msï¼ˆå…¨çƒå¹³å‡ï¼‰
```

---

### **æµç¨‹ 3ï¼šæŸ¥çœ‹åˆ†ææ•¸æ“š**

```
1. ç”¨æˆ¶åœ¨ app.oao.to/analytics/abc123
   â†“
2. Frontend ç™¼é€è«‹æ±‚
   GET https://api.oao.to/api/analytics/abc123
   Headers: { Authorization: "Bearer <JWT>" }
   â†“
3. API Worker è™•ç†
   - JWT é©—è­‰
   - æª¢æŸ¥æ‰€æœ‰æ¬Šï¼ˆå¾ D1ï¼‰
   â†“
4. æŸ¥è©¢ Analytics Engine
   SQL: SELECT country, COUNT(*) 
        FROM link_clicks 
        WHERE slug='abc123' 
        GROUP BY country
   â†“
5. åŒ¯ç¸½æ•¸æ“š
   - ç¸½é»æ“Šæ•¸
   - æŒ‰åœ‹å®¶åˆ†çµ„
   - æ™‚é–“è¶¨å‹¢
   - è¨­å‚™é¡å‹
   â†“
6. å›å‚³ JSON
   { totalClicks: 1234, byCountry: [...], ... }
   â†“
7. å‰ç«¯æ¸²æŸ“åœ–è¡¨
   Recharts é¡¯ç¤ºè¦–è¦ºåŒ–æ•¸æ“š
```

---

## ğŸ”‘ è³‡æºå…±äº«ç­–ç•¥

### **Workers KVï¼ˆcore å’Œ api å…±äº«ï¼‰**

```
Namespace ID: 8f133853496a4bdfb8151a39dd251518

core-workerï¼ˆåªè®€ï¼‰ï¼š
â””â”€â”€ KV.get('link:*') â†’ è®€å–çŸ­ç¶²å€æ•¸æ“š

api-workerï¼ˆè®€å¯«ï¼‰ï¼š
â”œâ”€â”€ KV.put('link:*', data) â†’ å‰µå»ºçŸ­ç¶²å€
â”œâ”€â”€ KV.get('link:*') â†’ é©—è­‰å­˜åœ¨
â””â”€â”€ KV.delete('link:*') â†’ åˆªé™¤çŸ­ç¶²å€

é‡è¦ï¼š
- åŒä¸€å€‹ KV namespace
- Core åªè®€ï¼ˆæ€§èƒ½å„ªåŒ–ï¼‰
- API å¯å¯«ï¼ˆæ¥­å‹™é‚è¼¯ï¼‰
```

### **D1 Databaseï¼ˆapi ç¨ä½”ï¼‰**

```
Database: oao-to-db (db9693c9-d2de-43b7-ad28-e2211e736e16)

api-worker ä½¿ç”¨ï¼š
â”œâ”€â”€ users è¡¨ â†’ ç”¨æˆ¶è³‡æ–™
â”œâ”€â”€ links è¡¨ â†’ çŸ­ç¶²å€å…ƒæ•¸æ“š
â””â”€â”€ å…¶ä»–æ¥­å‹™è¡¨

core-workerï¼š
â””â”€â”€ ä¸è¨ªå• D1ï¼ˆä¿æŒæ¥µè‡´ç°¡å–®ï¼‰

ç‚ºä»€éº¼ï¼š
- D1 æŸ¥è©¢æœ‰å»¶é²ï¼ˆ< 50msï¼‰
- Core éœ€è¦æ¥µè‡´å¿«é€Ÿï¼ˆ< 5msï¼‰
- æ‰€ä»¥ Core åªç”¨ KV
```

### **Analytics Engineï¼ˆcore å¯«å…¥ï¼Œapi æŸ¥è©¢ï¼‰**

```
Dataset: link_clicks

core-workerï¼ˆå¯«å…¥ï¼‰ï¼š
â””â”€â”€ æ¯æ¬¡é‡å®šå‘æ™‚å¯«å…¥é»æ“Šäº‹ä»¶
    â”œâ”€â”€ blob: [slug, url, country, city, ...]
    â”œâ”€â”€ doubles: [timestamp, lat, lng]
    â””â”€â”€ indexes: [slug, userId]

api-workerï¼ˆæŸ¥è©¢ï¼‰ï¼š
â””â”€â”€ SQL æŸ¥è©¢åˆ†ææ•¸æ“š
    SELECT country, COUNT(*) 
    FROM link_clicks 
    WHERE slug='abc123' 
    GROUP BY country
```

---

## ğŸ¯ ç‚ºä»€éº¼é¸æ“‡é€™å€‹æ¶æ§‹ï¼Ÿ

### **1. é¿å…è·¯ç”±è¡çª**

**å–®é«”æ¶æ§‹çš„å•é¡Œ**ï¼š
```
oao.to (å–®ä¸€ Worker)
â”œâ”€â”€ GET /:slug â†’ é‡å®šå‘
â”œâ”€â”€ GET /api/links â†’ API
â””â”€â”€ GET /dashboard â†’ å‰ç«¯

å•é¡Œï¼š
å¦‚æœç”¨æˆ¶å‰µå»º slug = "api" æˆ– "dashboard"ï¼Ÿ
â†’ è·¯ç”±è¡çªï¼
```

**æˆ‘å€‘çš„è§£æ±º**ï¼š
```
oao.to â†’ æ‰€æœ‰ slug éƒ½å¯ä»¥ï¼ˆç„¡ä¿ç•™å­—ï¼‰
api.oao.to â†’ API æœå‹™
app.oao.to â†’ å‰ç«¯ UI

å®Œå…¨ç„¡è¡çªï¼âœ…
```

### **2. è·è²¬å–®ä¸€åŸå‰‡**

```
Core Workerï¼š
- åªåšä¸€ä»¶äº‹ï¼šé‡å®šå‘
- æ¥µè‡´ç°¡å–®
- æ¥µè‡´ç©©å®š

API Workerï¼š
- åªåšä¸€ä»¶äº‹ï¼šæ¥­å‹™é‚è¼¯
- å¯ä»¥é »ç¹æ›´æ–°
- ä¸å½±éŸ¿æ ¸å¿ƒæœå‹™

Frontendï¼š
- åªåšä¸€ä»¶äº‹ï¼šUI å±•ç¤º
- å¯ä»¥ä»»æ„æ”¹ç‰ˆ
- ä¸å½±éŸ¿å¾Œç«¯
```

### **3. ç¨ç«‹éƒ¨ç½²**

```
æƒ…å¢ƒï¼šéœ€è¦æ›´æ–°åˆ†æåŠŸèƒ½

å–®é«”æ¶æ§‹ï¼š
â”œâ”€â”€ ä¿®æ”¹ç¨‹å¼ç¢¼
â”œâ”€â”€ é‡æ–°éƒ¨ç½²æ•´å€‹ Worker
â””â”€â”€ æ ¸å¿ƒé‡å®šå‘æœå‹™ä¹Ÿå—å½±éŸ¿ âš ï¸

å¾®æœå‹™æ¶æ§‹ï¼š
â”œâ”€â”€ åªä¿®æ”¹ API Worker
â”œâ”€â”€ åªéƒ¨ç½² API Worker
â””â”€â”€ æ ¸å¿ƒé‡å®šå‘æœå‹™å®Œå…¨ä¸å—å½±éŸ¿ âœ…
```

### **4. å¯æ“´å±•æ€§**

```
æœªä¾†æƒ³åŠ æ–°åŠŸèƒ½ï¼š

stats.oao.to    â†’ å…¬é–‹çµ±è¨ˆé é¢
docs.oao.to     â†’ æ–‡æª”ç¶²ç«™
blog.oao.to     â†’ éƒ¨è½æ ¼
webhook.oao.to  â†’ Webhook æœå‹™

è¼•é¬†ï¼åªéœ€è¦éƒ¨ç½²æ–°çš„ Worker/Pages
```

### **5. ç¬¦åˆæ¥­ç•Œæ¨™æº–**

```
Bitly:
â”œâ”€â”€ bit.ly (çŸ­ç¶²å€)
â”œâ”€â”€ app.bitly.com (ç®¡ç†ä»‹é¢)
â””â”€â”€ api-ssl.bitly.com (API)

Rebrandly:
â”œâ”€â”€ rebrandly.com (çŸ­ç¶²å€)
â”œâ”€â”€ app.rebrandly.com (ç®¡ç†ä»‹é¢)
â””â”€â”€ api.rebrandly.com (API)

æˆ‘å€‘ï¼š
â”œâ”€â”€ oao.to (çŸ­ç¶²å€)
â”œâ”€â”€ app.oao.to (ç®¡ç†ä»‹é¢)
â””â”€â”€ api.oao.to (API)

å®Œå…¨ä¸€è‡´ï¼âœ…
```

---

## ğŸ”§ æŠ€è¡“å¯¦ç¾

### **Core Worker æ ¸å¿ƒç¨‹å¼ç¢¼**

```typescript
// æ¥µè‡´ç°¡å–®çš„å¯¦ç¾
app.get('/:slug', async (c) => {
  const slug = c.req.param('slug');
  
  // å¾ KV è®€å–ï¼ˆ< 5msï¼‰
  const linkData = await c.env.LINKS.get(`link:${slug}`);
  if (!linkData) return c.notFound();
  
  const link = JSON.parse(linkData);
  
  // èƒŒæ™¯è¿½è¹¤ï¼ˆä¸é˜»å¡ï¼‰
  c.executionCtx.waitUntil(trackClick(c.env, slug, link, c.req));
  
  // ç«‹å³é‡å®šå‘
  return c.redirect(link.url, 301);
});
```

**é—œéµ**ï¼š
- ç„¡æ¢ä»¶åˆ¤æ–·
- ç„¡æ¥­å‹™é‚è¼¯
- ç„¡è³‡æ–™åº«æŸ¥è©¢
- ç´”ç²¹çš„ KV + Redirect

---

### **API Worker æ ¸å¿ƒç¨‹å¼ç¢¼**

```typescript
const app = new Hono();

// CORSï¼ˆå…è¨± app.oao.to èª¿ç”¨ï¼‰
app.use('*', cors({
  origin: ['https://app.oao.to'],
  credentials: true,
}));

// å…¬é–‹å‰µå»º
app.post('/shorten', shortenHandler);

// èªè­‰ä¿è­·çš„ API
app.use('/api/*', jwtMiddleware);
app.route('/api/auth', authRouter);
app.route('/api/links', linksRouter);
app.route('/api/analytics', analyticsRouter);
```

**é—œéµ**ï¼š
- å®Œæ•´çš„æ¥­å‹™é‚è¼¯
- èªè­‰èˆ‡æˆæ¬Š
- æ•¸æ“šé©—è­‰
- éŒ¯èª¤è™•ç†

---

### **Frontend æ ¸å¿ƒæ¶æ§‹**

```typescript
// è·¯ç”±
<Routes>
  <Route path="/" element={<Home />} />
  <Route path="/dashboard" element={<Dashboard />} />
  <Route path="/analytics/:slug" element={<Analytics />} />
</Routes>

// API èª¿ç”¨
const api = {
  createLink: (data) => 
    fetch('https://api.oao.to/api/links', { method: 'POST', body: JSON.stringify(data) }),
  
  getAnalytics: (slug) => 
    fetch(`https://api.oao.to/api/analytics/${slug}`)
};
```

**é—œéµ**ï¼š
- ç´”å‰ç«¯ React
- ç„¡å¾Œç«¯é‚è¼¯
- é€šé HTTP èª¿ç”¨ API

---

## ğŸ’¾ æ•¸æ“šæ¶æ§‹

### **Workers KV çµæ§‹**

```typescript
Key: "link:{slug}"
Value: {
  slug: string,
  url: string,
  userId: string,
  createdAt: number,
  expiresAt?: number,
  password?: string,
  title?: string
}

ç¯„ä¾‹ï¼š
Key: "link:abc123"
Value: {
  "slug": "abc123",
  "url": "https://example.com",
  "userId": "user-123",
  "createdAt": 1768390000000,
  "title": "Example Site"
}
```

### **D1 Database Schema**

```sql
-- ç”¨æˆ¶è¡¨
CREATE TABLE users (
  id TEXT PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  name TEXT NOT NULL,
  avatar TEXT,
  created_at INTEGER NOT NULL
);

-- çŸ­ç¶²å€è¡¨ï¼ˆå…ƒæ•¸æ“šï¼‰
CREATE TABLE links (
  slug TEXT PRIMARY KEY,
  url TEXT NOT NULL,
  user_id TEXT NOT NULL,
  title TEXT,
  created_at INTEGER NOT NULL,
  FOREIGN KEY (user_id) REFERENCES users(id)
);
```

**ç‚ºä»€éº¼éœ€è¦ D1ï¼Ÿ**
- KVï¼šå¿«é€Ÿè®€å¯«ï¼ˆé‡å®šå‘ç”¨ï¼‰
- D1ï¼šè¤‡é›œæŸ¥è©¢ï¼ˆã€Œæˆ‘çš„æ‰€æœ‰çŸ­ç¶²å€ã€ï¼‰

### **Analytics Engine æ•¸æ“š**

```typescript
WriteDataPoint({
  blobs: [
    slug,           // blob1: çŸ­ç¶²å€
    url,            // blob2: ç›®æ¨™ç¶²å€
    userId,         // blob3: å‰µå»ºè€…
    country,        // blob4: è¨ªå•åœ‹å®¶
    city,           // blob5: è¨ªå•åŸå¸‚
    device,         // blob6: è¨­å‚™é¡å‹
  ],
  doubles: [
    timestamp,      // double1: æ™‚é–“æˆ³
    latitude,       // double2: ç·¯åº¦
    longitude,      // double3: ç¶“åº¦
  ],
  indexes: [slug, userId]  // ç´¢å¼•ï¼ˆåŠ é€ŸæŸ¥è©¢ï¼‰
});
```

**æŸ¥è©¢ç¯„ä¾‹**ï¼š
```sql
SELECT blob4 as country, COUNT(*) as clicks
FROM link_clicks
WHERE blob1 = 'abc123'
GROUP BY country
ORDER BY clicks DESC
```

---

## ğŸš€ æ€§èƒ½å„ªåŒ–

### **ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆå¿«ï¼Ÿ**

#### **1. é‚Šç·£é‹ç®—**
```
Cloudflare å…¨çƒ 300+ è³‡æ–™ä¸­å¿ƒï¼š
â”œâ”€â”€ ç”¨æˆ¶è¨ªå•æœ€è¿‘çš„ç¯€é»
â”œâ”€â”€ Core Worker åœ¨é‚Šç·£åŸ·è¡Œ
â”œâ”€â”€ KV åœ¨é‚Šç·£å¿«å–
â””â”€â”€ å»¶é²ï¼š< 10msï¼ˆå…¨çƒå¹³å‡ï¼‰
```

#### **2. è·è²¬åˆ†é›¢**
```
é‡å®šå‘è·¯å¾‘ï¼ˆç†±è·¯å¾‘ï¼‰ï¼š
User â†’ Core Worker â†’ KV â†’ Redirect
      æ¥µè‡´ç°¡å–®ï¼Œç„¡å¹²æ“¾

ç®¡ç†è·¯å¾‘ï¼ˆå†·è·¯å¾‘ï¼‰ï¼š
User â†’ API Worker â†’ KV + D1 + Analytics
      å¯ä»¥è¤‡é›œï¼Œä¸å½±éŸ¿æ ¸å¿ƒ
```

#### **3. èƒŒæ™¯ä»»å‹™**
```typescript
// è¿½è¹¤ä¸é˜»å¡é‡å®šå‘
c.executionCtx.waitUntil(
  trackClick(...)  // èƒŒæ™¯åŸ·è¡Œ
);

return c.redirect(url, 301);  // ç«‹å³è¿”å›
```

---

## ğŸ’° æˆæœ¬åˆ†æ

### **100 è¬æ¬¡/å¤©è¨ªå•**

```
Core Workerï¼š
- 100 è¬æ¬¡è«‹æ±‚
- 100 è¬æ¬¡ KV è®€å–
- æˆæœ¬ï¼š~$0.90/å¤©

API Workerï¼š
- 1 è¬æ¬¡ API èª¿ç”¨ï¼ˆ1% æµé‡ï¼‰
- 1 è¬æ¬¡ KV å¯«å…¥
- 1 è¬æ¬¡ D1 æŸ¥è©¢
- æˆæœ¬ï¼š~$0.15/å¤©

Analytics Engineï¼š
- 100 è¬æ¬¡å¯«å…¥
- ç„¡é™æ¬¡æŸ¥è©¢
- æˆæœ¬ï¼š~$0.25/å¤©

Frontendï¼ˆPagesï¼‰ï¼š
- éœæ…‹è¨—ç®¡
- æˆæœ¬ï¼š$0

ç¸½è¨ˆï¼š~$1.3/å¤© = $39/æœˆ
```

**vs ç«¶å“**ï¼š
- Bitly Pro: $29/æœˆï¼ˆé™ 500 å€‹éˆæ¥ï¼‰
- Rebrandly: $34/æœˆï¼ˆé™ 5000 æ¬¡é»æ“Šï¼‰

**æˆ‘å€‘**ï¼š
- $39/æœˆï¼ˆ100 è¬æ¬¡é»æ“Šï¼‰
- ç„¡é™éˆæ¥
- å®Œå…¨æŒæ§æ•¸æ“š

---

## ğŸ¯ æ¶æ§‹å„ªå‹¢ç¸½çµ

### **æŠ€è¡“å„ªå‹¢**

1. âœ… **æ¥µè‡´æ€§èƒ½**ï¼š< 10ms é‡å®šå‘
2. âœ… **ç„¡é™æ“´å±•**ï¼šè‡ªå‹•æ“´å±•åˆ°å…¨çƒ
3. âœ… **é«˜å¯ç”¨æ€§**ï¼š99.99%+ SLA
4. âœ… **é›¶ç¶­è­·**ï¼šç„¡ä¼ºæœå™¨ç®¡ç†

### **æ¥­å‹™å„ªå‹¢**

1. âœ… **è·¯ç”±éˆæ´»**ï¼šç”¨æˆ¶å¯å‰µå»ºä»»æ„ slug
2. âœ… **ç¨ç«‹éƒ¨ç½²**ï¼šæœå‹™äº’ä¸å½±éŸ¿
3. âœ… **æ˜“æ–¼æ“´å±•**ï¼šè¼•é¬†åŠ æ–°åŠŸèƒ½
4. âœ… **æ•¸æ“šæŒæ§**ï¼šå®Œå…¨æ“æœ‰æ•¸æ“š

### **é–‹ç™¼å„ªå‹¢**

1. âœ… **è·è²¬æ¸…æ™°**ï¼šæ¯å€‹æœå‹™å–®ä¸€è·è²¬
2. âœ… **æ˜“æ–¼æ¸¬è©¦**ï¼šå„è‡ªç¨ç«‹æ¸¬è©¦
3. âœ… **åœ˜éšŠå”ä½œ**ï¼šä¸åŒæœå‹™å¯ä¸¦è¡Œé–‹ç™¼
4. âœ… **ç¬¦åˆæ¨™æº–**ï¼šæ¥­ç•Œæœ€ä½³å¯¦è¸

---

## ğŸ“Š èˆ‡å–®é«”æ¶æ§‹å°æ¯”

| é …ç›® | å–®é«”æ¶æ§‹ | å¾®æœå‹™æ¶æ§‹ï¼ˆæˆ‘å€‘ï¼‰ |
|------|---------|-------------------|
| **è·¯ç”±è¡çª** | âš ï¸ æœ‰é¢¨éšª | âœ… ç„¡é¢¨éšª |
| **éƒ¨ç½²å½±éŸ¿** | âš ï¸ ç‰½ä¸€é«®å‹•å…¨èº« | âœ… ç¨ç«‹éƒ¨ç½² |
| **é–‹ç™¼è¤‡é›œåº¦** | âœ… ç°¡å–® | âš ï¸ ä¸­ç­‰ |
| **é‹ç¶­è¤‡é›œåº¦** | âš ï¸ å–®é»æ•…éšœ | âœ… åˆ†æ•£é¢¨éšª |
| **æ“´å±•æ€§** | âš ï¸ å—é™ | âœ… éˆæ´» |
| **æ€§èƒ½** | âš ï¸ æ··åˆé‚è¼¯ | âœ… æ ¸å¿ƒæ¥µè‡´å„ªåŒ– |
| **é©ç”¨è¦æ¨¡** | å°å‹ | ä¸­å¤§å‹ âœ… |

---

## ğŸ“ è¨­è¨ˆæ±ºç­–è¨˜éŒ„

### **ç‚ºä»€éº¼åˆ†æˆ 3 å€‹æœå‹™ï¼Ÿ**

**æ±ºç­–**ï¼šcore + api + frontend

**ç†ç”±**ï¼š
1. Core æ¥µè‡´ç°¡å–® â†’ æ€§èƒ½æœ€ä½³
2. API é›†ä¸­æ¥­å‹™é‚è¼¯ â†’ æ˜“æ–¼ç®¡ç†
3. Frontend ç´”å±•ç¤º â†’ æ˜“æ–¼æ”¹ç‰ˆ

**æ›¿ä»£æ–¹æ¡ˆ**ï¼š
- âŒ å–®ä¸€ Workerï¼šè·¯ç”±è¡çªé¢¨éšª
- âŒ Core + API åˆä½µï¼šæ€§èƒ½å—å½±éŸ¿
- âœ… ä¸‰å±¤åˆ†é›¢ï¼šæœ€ä½³å¹³è¡¡

---

### **ç‚ºä»€éº¼ Core å’Œ API å…±äº« KVï¼Ÿ**

**æ±ºç­–**ï¼šåŒä¸€å€‹ KV namespace

**ç†ç”±**ï¼š
1. Core éœ€è¦è®€å–çŸ­ç¶²å€
2. API éœ€è¦å¯«å…¥çŸ­ç¶²å€
3. å¿…é ˆå…±äº«åŒä¸€ä»½æ•¸æ“š

**æ›¿ä»£æ–¹æ¡ˆ**ï¼š
- âŒ å…©å€‹ KVï¼šéœ€è¦åŒæ­¥ï¼ˆè¤‡é›œï¼‰
- âŒ API ä»£ç†è®€å–ï¼šå¢åŠ å»¶é²
- âœ… å…±äº« KVï¼šç°¡å–®é«˜æ•ˆ

---

### **ç‚ºä»€éº¼ Frontend ç”¨ Pages ä¸ç”¨ Workerï¼Ÿ**

**æ±ºç­–**ï¼šCloudflare Pages

**ç†ç”±**ï¼š
1. ç´”éœæ…‹å‰ç«¯ï¼ˆReactï¼‰
2. ç„¡éœ€ Workers åŠŸèƒ½
3. Pages æ›´é©åˆå‰ç«¯æ¡†æ¶
4. è‡ªå‹• SSR æ”¯æ´

**æ›¿ä»£æ–¹æ¡ˆ**ï¼š
- âš ï¸ Workers + Assetsï¼šå¯è¡Œä½†éåº¦
- âœ… Pagesï¼šå°ˆç‚ºå‰ç«¯è¨­è¨ˆ

---

## âœ… æ¶æ§‹é©—è­‰

### **å¯æ“´å±•æ€§**

```
ç¾åœ¨ï¼š3 å€‹æœå‹™
æœªä¾†ï¼š10+ å€‹æœå‹™

è¼•é¬†åŠ å…¥ï¼š
- QR Code ç”Ÿæˆæœå‹™
- çµ±è¨ˆå„€è¡¨æ¿
- Webhook æœå‹™
- ...

æ¶æ§‹æ”¯æ´ç„¡é™æ“´å±•ï¼
```

### **å¯ç¶­è­·æ€§**

```
æ¯å€‹æœå‹™ï¼š
â”œâ”€â”€ ç¨ç«‹ä»£ç¢¼åº«ï¼ˆå¯ä»¥æ˜¯ï¼‰
â”œâ”€â”€ ç¨ç«‹éƒ¨ç½²
â”œâ”€â”€ ç¨ç«‹æ¸¬è©¦
â””â”€â”€ ç¨ç«‹ç›£æ§

ç¶­è­·æˆæœ¬ï¼šä½
```

### **æ€§èƒ½é©—è­‰**

```
å¯¦æ¸¬ï¼š
â”œâ”€â”€ é‡å®šå‘ï¼š< 5ms
â”œâ”€â”€ API èª¿ç”¨ï¼š< 50ms
â”œâ”€â”€ å‰ç«¯è¼‰å…¥ï¼š< 500ms

å…¨çƒå¹³å‡ï¼š
â””â”€â”€ çŸ­ç¶²å€è¨ªå• < 10ms

ç¬¦åˆç›®æ¨™ï¼âœ…
```

---

## ğŸ¯ é€™æ˜¯ä¸€å€‹ç”Ÿç”¢ç´šã€å¯æ“´å±•ã€ç¬¦åˆæ¥­ç•Œæ¨™æº–çš„å°ˆæ¥­æ¶æ§‹ï¼

**é©ç”¨å ´æ™¯**ï¼š
- âœ… ç™¾è¬ç”¨æˆ¶ç´šçŸ­ç¶²å€æœå‹™
- âœ… éœ€è¦è©³ç´°åˆ†æçš„å ´æ™¯
- âœ… éœ€è¦ç”¨æˆ¶ç³»çµ±çš„å ´æ™¯
- âœ… éœ€è¦é•·æœŸç¶­è­·çš„ç”¢å“

**ä¸é©ç”¨å ´æ™¯**ï¼š
- âŒ å€‹äººå°å°ˆæ¡ˆï¼ˆéåº¦è¨­è¨ˆï¼‰
- âŒ ä¸€æ¬¡æ€§ä½¿ç”¨ï¼ˆå¤ªè¤‡é›œï¼‰

**æˆ‘å€‘çš„å®šä½**ï¼šå°ˆæ¥­ã€å¯æ“´å±•çš„ç”Ÿç”¢ç´šæœå‹™ âœ…

