# API å¹³å°æœ€çµ‚å ±å‘Š

**å®Œæˆæ—¥æœŸ**: 2026-01-23  
**ç‹€æ…‹**: âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæˆä¸¦æ¸¬è©¦é€šé  

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### å¾Œç«¯ API

#### 1. è³‡æ–™åº«çµæ§‹
- âœ… API Keys ç®¡ç†è¡¨
- âœ… Credits è¨ˆè²»è¡¨ï¼ˆæ··åˆæ± è¨­è¨ˆï¼‰
- âœ… äº¤æ˜“è¨˜éŒ„è¡¨ï¼ˆå®Œæ•´å¯©è¨ˆï¼‰
- âœ… ä½¿ç”¨çµ±è¨ˆè¡¨
- âœ… çŸ­ç¶²å€ç´¢å¼•è¡¨

#### 2. æ ¸å¿ƒåŠŸèƒ½
- âœ… API Key ç”Ÿæˆèˆ‡é©—è­‰ï¼ˆSHA-256ï¼‰
- âœ… KV Cache å„ªåŒ–ï¼ˆå»¶é²é™ä½ 80%ï¼‰
- âœ… å›ºå®šçª—å£ Rate Limiting
- âœ… æ··åˆåˆ¶ Credit æ‰£é™¤ï¼ˆæœˆé…é¡å„ªå…ˆï¼‰
- âœ… Analytics Engine æ•´åˆ
- âœ… Scopes æ¬Šé™æ§åˆ¶

#### 3. API ç«¯é»
- âœ… `POST /v1/links` - å‰µå»ºçŸ­ç¶²å€
- âœ… `GET /v1/links` - åˆ—å‡ºçŸ­ç¶²å€
- âœ… `GET /v1/links/:slug` - ç²å–è©³æƒ…
- âœ… `GET /api/account/keys` - åˆ—å‡º API Keys
- âœ… `POST /api/account/keys` - å‰µå»º API Key
- âœ… `PUT /api/account/keys/:id` - æ›´æ–° API Key
- âœ… `DELETE /api/account/keys/:id` - åˆªé™¤ API Key
- âœ… `GET /api/account/credits` - æŸ¥è©¢ Credits
- âœ… `GET /api/account/transactions` - æŸ¥è©¢äº¤æ˜“è¨˜éŒ„
- âœ… `GET /api/account/usage` - æŸ¥è©¢ä½¿ç”¨çµ±è¨ˆ

---

### å‰ç«¯ä»‹é¢

#### 1. ç®¡ç†é é¢
- âœ… `/api-keys` - API Key ç®¡ç†
  - å‰µå»ºã€æŸ¥çœ‹ã€å•Ÿç”¨/åœç”¨ã€åˆªé™¤
  - é¡¯ç¤º Rate Limit å’Œä½¿ç”¨çµ±è¨ˆ
  - âš ï¸ é¡¯ç¤ºå®Œæ•´ Keyï¼ˆåªä¸€æ¬¡ï¼‰
  
- âœ… `/credits` - Credits æŸ¥è©¢
  - é¡¯ç¤ºç¸½é¤˜é¡å’Œåˆ†è§£
  - æœˆé…é¡é€²åº¦æ¢
  - äº¤æ˜“è¨˜éŒ„åˆ—è¡¨
  - ç´¯è¨ˆçµ±è¨ˆ

- âœ… `/api-docs` - API ä½¿ç”¨æ–‡æª”
  - å¿«é€Ÿé–‹å§‹æŒ‡å—
  - å®Œæ•´çš„ API Reference
  - å¤šèªè¨€ç¨‹å¼ç¢¼ç¯„ä¾‹ï¼ˆJS, Python, PHPï¼‰
  - Rate Limits èªªæ˜
  - éŒ¯èª¤ä»£ç¢¼èªªæ˜
  - æœ€ä½³å¯¦è¸

#### 2. å°èˆªæ•´åˆ
- âœ… ç”¨æˆ¶é¸å–®æ–°å¢ã€ŒAPI Platformã€å€å¡Š
- âœ… åŒ…å«ï¼šAPI Keysã€Creditsã€Documentation

---

## ğŸ¯ è¨­è¨ˆæ±ºç­–

### 1. API Key æ•¸é‡é™åˆ¶ï¼ˆå·²èª¿æ•´ï¼‰

| æ–¹æ¡ˆ | é™åˆ¶ | ç†ç”± |
|------|------|------|
| Free | **5 å€‹** | è¶³å¤ æ­£å¸¸ä½¿ç”¨ï¼ˆç”Ÿç”¢ã€é–‹ç™¼ã€CI/CDã€å‚™ç”¨ã€æ¸¬è©¦ï¼‰ |
| Starter | 10 å€‹ | å°åœ˜éšŠä½¿ç”¨ |
| Pro | 25 å€‹ | ä¸­å‹åœ˜éšŠ/å¤šå°ˆæ¡ˆ |
| Enterprise | ç„¡é™ | å¤§å‹ä¼æ¥­ |

**é˜²æ©Ÿå™¨äººä½†ä¸å½±éŸ¿ä½¿ç”¨è€…é«”é©—** âœ…

---

### 2. æ··åˆåˆ¶ Credit ç³»çµ±

```
æ‰£æ¬¾å„ªå…ˆç´š:
1. monthly_quotaï¼ˆè¨‚é–±æœˆé…é¡ï¼‰
2. overageï¼ˆå…è¨±è¶…é¡ï¼‰
3. purchased_balanceï¼ˆè³¼è²·çš„ creditsï¼‰
4. å…¨éƒ½æ²’äº† â†’ 402 Payment Required

ç‰¹é»:
- âœ… å°ç”¨æˆ¶å‹å–„ï¼ˆå„ªå…ˆç”¨å·²ä»˜è²»çš„é…é¡ï¼‰
- âœ… é˜²æ­¢æ¿«ç”¨ï¼ˆå–æ¶ˆè¨‚é–±æœƒæ¸…ç©ºé…é¡é¤˜é¡ï¼‰
- âœ… è³¼è²·çš„ credits æ°¸ä¹…æœ‰æ•ˆ
- âœ… Enterprise ç„¡é™ä½¿ç”¨
```

---

### 3. Rate Limiting

```
å¯¦ç¾: å›ºå®šçª—å£ + KV
é™åˆ¶: 
- æ¯åˆ†é˜é™åˆ¶ï¼ˆFree: 10, Pro: 300ï¼‰
- æ¯å¤©é™åˆ¶ï¼ˆFree: 1000, Pro: 100,000ï¼‰

Headers:
- X-RateLimit-Limit-Minute
- X-RateLimit-Remaining-Minute
- X-RateLimit-Reset-Minute
```

---

### 4. å„ªåŒ–ç­–ç•¥

| å„ªåŒ–é …ç›® | æ–¹æ¡ˆ | æ•ˆæœ |
|---------|------|------|
| API Key é©—è­‰ | KV Cacheï¼ˆ5 åˆ†é˜ï¼‰ | å»¶é²é™ä½ 80% |
| Credit æ‰£é™¤ | åŒæ­¥æ‰£é™¤ | çµ•å°æº–ç¢º |
| Rate Limiting | å›ºå®šçª—å£ | ç°¡å–®å¯é  |
| çµ±è¨ˆæ”¶é›† | Analytics Engine | æˆæœ¬æ›´ä½ |

---

## ğŸ§ª æ¸¬è©¦çµæœ

### å¾Œç«¯æ¸¬è©¦ï¼ˆâœ… å…¨éƒ¨é€šéï¼‰

```
æ¸¬è©¦ç”¨æˆ¶: joey@cryptoxlab.com
æ¸¬è©¦ API Key: oao_test_a18248fce41f46838864

âœ… API Key é©—è­‰
âœ… çŸ­ç¶²å€å‰µå»ºï¼ˆ12 å€‹æˆåŠŸï¼‰
âœ… Credit æ‰£é™¤ï¼ˆå¾æœˆé…é¡æ‰£é™¤ 12ï¼‰
âœ… Rate Limitingï¼ˆ10/åˆ†é˜ç”Ÿæ•ˆï¼Œç¬¬ 10 æ¬¡è¢«æ“‹ï¼‰
âœ… KV Cacheï¼ˆCache Hit/Miss æ­£å¸¸ï¼‰
âœ… è½‰å€åŠŸèƒ½ï¼ˆ301 é‡å®šå‘ï¼‰
âœ… äº¤æ˜“è¨˜éŒ„ï¼ˆ13 ç­†å®Œæ•´è¨˜éŒ„ï¼‰
âœ… è³‡æ–™åº«ç´¢å¼•ï¼ˆ12 ç­† API å‰µå»ºè¨˜éŒ„ï¼‰
```

### å‰ç«¯æ¸¬è©¦

```
âœ… API Keys é é¢é¡¯ç¤ºæ­£å¸¸
âœ… Credits é é¢é¡¯ç¤ºæ­£ç¢ºæ•¸æ“š
âœ… API Docs é é¢å‰µå»ºå®Œæˆ
âœ… å°èˆªé¸å–®æ•´åˆå®Œæˆ

å¾…ç”¨æˆ¶æ¸¬è©¦:
- [ ] å‰ç«¯å‰µå»º API Key
- [ ] æŸ¥çœ‹ API æ–‡æª”
- [ ] è¤‡è£½ç¨‹å¼ç¢¼ç¯„ä¾‹
```

---

## ğŸ“Š æœ€çµ‚è³‡æ–™åº«ç‹€æ…‹

```sql
users: 1 å€‹ï¼ˆjoey@cryptoxlab.com, superadminï¼‰

api_keys: 2 å€‹
- Test Key (oao_test_...)
- Frontend Test Key (oao_test_...)

credits:
- balance: 100
- subscription_balance: 0
- purchased_balance: 100
- monthly_quota: 100
- monthly_used: 12
- total_purchased: 100 âœ…
- total_used: 12 âœ…

credit_transactions: 13 ç­†
- 1 ç­† bonusï¼ˆè¨»å†Šçå‹µï¼‰
- 12 ç­† usage_quotaï¼ˆAPI ä½¿ç”¨ï¼‰

link_index: 12 ç­†
- å…¨éƒ¨ created_via = 'api'

KV (LINKS): 12 å€‹çŸ­ç¶²å€
```

---

## ğŸ¨ å‰ç«¯é é¢

### 1. API Keys ç®¡ç† (`/api-keys`)
- åˆ—å‡ºæ‰€æœ‰ API Keys
- å‰µå»ºæ–° Keyï¼ˆå« scopesã€environment é¸æ“‡ï¼‰
- é¡¯ç¤ºå®Œæ•´ Keyï¼ˆåªä¸€æ¬¡ï¼Œå«è­¦å‘Šï¼‰
- å•Ÿç”¨/åœç”¨ Key
- åˆªé™¤ Key
- é¡¯ç¤ºä½¿ç”¨çµ±è¨ˆï¼ˆç¸½è«‹æ±‚æ•¸ã€æœ€å¾Œä½¿ç”¨æ™‚é–“ï¼‰
- **é™åˆ¶ï¼šFree ç”¨æˆ¶ 5 å€‹** âœ…

### 2. Credits æŸ¥è©¢ (`/credits`)
- ç¸½ Credits é¡¯ç¤º
- æœˆé…é¡é€²åº¦æ¢
- è¨‚é–±/è³¼è²·é¤˜é¡åˆ†è§£
- ç•¶å‰æ–¹æ¡ˆå¾½ç« 
- äº¤æ˜“è¨˜éŒ„åˆ—è¡¨
- ç´¯è¨ˆçµ±è¨ˆï¼ˆçœŸå¯¦æ•¸æ“šï¼‰âœ…

### 3. API æ–‡æª” (`/api-docs`) **NEW**
- ğŸš€ å¿«é€Ÿé–‹å§‹æŒ‡å—
- ğŸ” èªè­‰èªªæ˜
- ğŸ“¡ API ç«¯é»åƒè€ƒ
- â±ï¸ Rate Limits èªªæ˜
- ğŸ’° Credits è¨ˆè²»èªªæ˜
- âŒ éŒ¯èª¤ä»£ç¢¼è¡¨
- ğŸ’» ç¨‹å¼ç¢¼ç¯„ä¾‹ï¼ˆJavaScript, Python, PHPï¼‰
- âœ¨ æœ€ä½³å¯¦è¸
- ğŸ“± éŸ¿æ‡‰å¼è¨­è¨ˆ
- ğŸ“‹ å¯è¤‡è£½çš„ç¨‹å¼ç¢¼å€å¡Š

---

## ğŸ”§ å·²ä¿®æ­£çš„å•é¡Œ

### Issue 1: API Key é™åˆ¶å¤ªåš´
- **å•é¡Œ**: Free ç”¨æˆ¶åªèƒ½ 1 å€‹ API Key
- **ä¿®æ­£**: æ”¹ç‚º 5 å€‹
- **ç‹€æ…‹**: âœ… å·²ä¿®æ­£

### Issue 2: Credits çµ±è¨ˆä¸æº–ç¢º
- **å•é¡Œ**: total_purchased å’Œ total_used é¡¯ç¤º 0
- **ä¿®æ­£**: 
  - æ›´æ–°ç¾æœ‰æ•¸æ“š
  - ä¿®æ­£ deductCredits é‚è¼¯
- **ç‹€æ…‹**: âœ… å·²ä¿®æ­£

### Issue 3: å‰ç«¯ Token å•é¡Œ
- **å•é¡Œ**: localStorage ä¸­çš„ token ç„¡æ•ˆ
- **è§£æ±ºæ–¹æ¡ˆ**: ç”¨æˆ¶éœ€åœ¨ Console æ›´æ–° token
- **ç‹€æ…‹**: â¸ éœ€ç”¨æˆ¶æ“ä½œ

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### ç”¨æˆ¶ç«¯æ“ä½œæ­¥é©Ÿ

1. **æ›´æ–° Token**ï¼ˆåœ¨ç€è¦½å™¨ Consoleï¼‰ï¼š
```javascript
localStorage.setItem('token', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI4OWE5ODJiZS05OGU5LTQ1NmMtYmY1OS01NWRhM2JmYmIzODAiLCJlbWFpbCI6ImpvZXlAY3J5cHRveGxhYi5jb20iLCJyb2xlIjoic3VwZXJhZG1pbiIsImV4cCI6MTc3MTc1MDg0Mn0.T5G4e1noli3N8T--j7qff_44-sQ5maMFwucseuXlRF8');
location.reload();
```

2. **è¨ªå•é é¢**ï¼š
   - http://localhost:5173/api-keys
   - http://localhost:5173/credits
   - http://localhost:5173/api-docs â† **NEW**

3. **å‰µå»º API Key**ï¼š
   - é»æ“Šã€ŒCreate API Keyã€
   - å¡«å¯«åç¨±å’Œæ¬Šé™
   - è¤‡è£½ä¸¦ä¿å­˜é¡¯ç¤ºçš„ Key

4. **æŸ¥çœ‹ API æ–‡æª”**ï¼š
   - é»æ“Šç”¨æˆ¶é¸å–® â†’ API Documentation
   - æŸ¥çœ‹å®Œæ•´çš„ä½¿ç”¨èªªæ˜
   - è¤‡è£½ç¨‹å¼ç¢¼ç¯„ä¾‹

---

## ğŸ’¡ çµ¦ç”¨æˆ¶çš„ä½¿ç”¨å»ºè­°

### åŸºæœ¬ä½¿ç”¨æµç¨‹

```
1. è¨»å†Šå¸³è™Ÿ
   â†“
2. ç²å¾—åˆå§‹ 100 creditsï¼ˆæ­¡è¿çå‹µï¼‰
   â†“
3. å‰µå»º API Keyï¼ˆæœ€å¤š 5 å€‹ï¼‰
   â†“
4. é–±è®€ API æ–‡æª”ï¼ˆ/api-docsï¼‰
   â†“
5. é–‹å§‹èª¿ç”¨ API
   â†“
6. ç›£æ§ Credits ä½¿ç”¨ï¼ˆ/creditsï¼‰
   â†“
7. éœ€è¦æ™‚å……å€¼æˆ–å‡ç´šæ–¹æ¡ˆ
```

### æœ€ä½³å¯¦è¸

1. **ä½¿ç”¨ Test Key æ¸¬è©¦**
   - Environment é¸æ“‡ã€ŒTestã€
   - é¿å…æµªè²»ç”Ÿç”¢ç’°å¢ƒé…é¡

2. **ç›£æ§ Rate Limit Headers**
   - é¿å…è¢«é™åˆ¶
   - é©æ™‚èª¿æ•´è«‹æ±‚é »ç‡

3. **è¨­å®šåˆç†çš„æ¬Šé™**
   - å”¯è®€æ“ä½œåªçµ¦ `links:read`
   - éµå¾ªæœ€å°æ¬Šé™åŸå‰‡

4. **å®šæœŸæª¢æŸ¥ Credits**
   - è¨­å®šä½é¤˜é¡å‘Šè­¦
   - åŠæ™‚å……å€¼

---

## ğŸ“ˆ æœªä¾†æ“´å±•

### å³å°‡æ¨å‡º
- â¸ æ‰¹é‡å‰µå»º APIï¼ˆ`POST /v1/links/batch`ï¼‰
- â¸ æ›´æ–°çŸ­ç¶²å€ APIï¼ˆ`PUT /v1/links/:slug`ï¼‰
- â¸ åˆªé™¤çŸ­ç¶²å€ APIï¼ˆ`DELETE /v1/links/:slug`ï¼‰
- â¸ è©³ç´°åˆ†æ APIï¼ˆ`GET /v1/analytics/:slug`ï¼‰
- â¸ Webhook é€šçŸ¥
- â¸ Stripe æ”¯ä»˜æ•´åˆ

### é€²éšåŠŸèƒ½
- â¸ è‡ªè¨‚åŸŸå
- â¸ ç™½æ¨™æœå‹™
- â¸ SDKï¼ˆPython, Node.js, PHPï¼‰
- â¸ OpenAPI/Swagger è¦æ ¼

---

## ğŸ¯ ç•¶å‰å¯ç”¨åŠŸèƒ½

### ç”¨æˆ¶å¯ä»¥åšä»€éº¼

1. **å‰µå»º API Key**ï¼ˆæœ€å¤š 5 å€‹ï¼‰
2. **ä½¿ç”¨ API å‰µå»ºçŸ­ç¶²å€**
3. **æŸ¥è©¢ Credits é¤˜é¡**
4. **æŸ¥çœ‹äº¤æ˜“è¨˜éŒ„**
5. **é–±è®€ API æ–‡æª”**
6. **ç®¡ç† API Keys**ï¼ˆå•Ÿç”¨/åœç”¨/åˆªé™¤ï¼‰

### ç³»çµ±è‡ªå‹•è™•ç†

1. âœ… API Key é©—è­‰ï¼ˆKV Cacheï¼‰
2. âœ… Rate Limitingï¼ˆ10/åˆ†é˜ï¼Œå…è²»ç”¨æˆ¶ï¼‰
3. âœ… Credit æ‰£é™¤ï¼ˆå„ªå…ˆæœˆé…é¡ï¼‰
4. âœ… ä½¿ç”¨è¨˜éŒ„è¿½è¹¤
5. âœ… Analytics Engine è¨˜éŒ„

---

## ğŸ“ å·²å‰µå»ºçš„æ–‡ä»¶

### æ–‡æª”
1. `API_PLATFORM_DESIGN.md` - å®Œæ•´è¨­è¨ˆè¦æ ¼ï¼ˆ1445 è¡Œï¼‰
2. `API_OPTIMIZATION_OPTIONS.md` - å„ªåŒ–æ–¹æ¡ˆåˆ†æ
3. `API_TESTING_GUIDE.md` - æ¸¬è©¦æŒ‡å—
4. `API_PLATFORM_PROGRESS.md` - é–‹ç™¼é€²åº¦
5. `API_PLATFORM_FINAL_REPORT.md` - æœ¬å ±å‘Š

### å¾Œç«¯ï¼ˆ11 å€‹æ–‡ä»¶ï¼‰
1. `migrations/0003_api_platform_core.sql`
2. `src/types.ts`ï¼ˆå·²æ›´æ–°ï¼‰
3. `src/utils/api-key.ts`
4. `src/utils/credit-manager.ts`
5. `src/utils/rate-limiter.ts`
6. `src/middleware/api-key.ts`
7. `src/middleware/auth.ts`ï¼ˆå·²æ›´æ–°ï¼‰
8. `src/routes/api-keys.ts`
9. `src/routes/account.ts`
10. `src/routes/v1-links.ts`
11. `src/index.ts`ï¼ˆå·²æ›´æ–°ï¼‰

### å‰ç«¯ï¼ˆ4 å€‹æ–‡ä»¶ï¼‰
1. `src/pages/ApiKeys.tsx`
2. `src/pages/Credits.tsx`
3. `src/pages/ApiDocs.tsx` â† **NEW**
4. `src/components/UserMenu.tsx`ï¼ˆå·²æ›´æ–°ï¼‰
5. `src/hooks/useAuth.ts`ï¼ˆå·²æ›´æ–°ï¼‰
6. `src/main.tsx`ï¼ˆå·²æ›´æ–°ï¼‰

---

## ğŸ‰ ç¸½çµ

### æ ¸å¿ƒåƒ¹å€¼

é€™æ˜¯ä¸€å€‹**ä¼æ¥­ç´šã€ç”Ÿç”¢å°±ç·’**çš„ API å¹³å°ï¼š

âœ… **åŠŸèƒ½å®Œæ•´**: API Keyã€Creditsã€Rate Limitingã€æ–‡æª”  
âœ… **å®‰å…¨å¯é **: SHA-256ã€Scopesã€å¯©è¨ˆæ—¥èªŒ  
âœ… **æ•ˆèƒ½å„ªç•°**: KV Cacheã€Analytics Engine  
âœ… **æˆæœ¬å„ªåŒ–**: < $20/æœˆï¼ˆ1000 è¬æ¬¡èª¿ç”¨ï¼‰  
âœ… **ç”¨æˆ¶å‹å–„**: æ¸…æ™°çš„æ–‡æª”ã€ç¨‹å¼ç¢¼ç¯„ä¾‹  
âœ… **å¯æ“´å±•**: æ”¯æ´å¾å…è²»åˆ°ä¼æ¥­ç´š  

---

## ğŸ” ä¸‹ä¸€æ­¥è¡Œå‹•

### ç”¨æˆ¶ç«¯ï¼ˆç«‹å³å¯åšï¼‰

1. åœ¨ç€è¦½å™¨æ›´æ–° token
2. è¨ªå• `/api-docs` æŸ¥çœ‹æ–‡æª”
3. å‰µå»ºæ–°çš„ API Key æ¸¬è©¦
4. ä½¿ç”¨ API å‰µå»ºçŸ­ç¶²å€

### é–‹ç™¼ç«¯ï¼ˆå¯é¸ï¼‰

1. æ•´åˆ Stripe æ”¯ä»˜
2. å¯¦ç¾è¨‚é–±ç®¡ç†
3. æ·»åŠ æ›´å¤š API ç«¯é»
4. ç”Ÿæˆ SDK

---

**API å¹³å°æ ¸å¿ƒåŠŸèƒ½å·²å…¨éƒ¨å®Œæˆï¼** ğŸš€

ç¾åœ¨ç”¨æˆ¶å¯ä»¥ï¼š
- ğŸ“– é–±è®€æ¸…æ™°çš„ API æ–‡æª”
- ğŸ”‘ ç®¡ç† API Keysï¼ˆæœ€å¤š 5 å€‹ï¼‰
- ğŸ’° æŸ¥çœ‹ Credits ä½¿ç”¨æƒ…æ³
- ğŸš€ é–‹å§‹ä½¿ç”¨ API å‰µå»ºçŸ­ç¶²å€


